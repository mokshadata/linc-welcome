function U(t,n=document){return typeof t=="string"?Array.from(n.querySelectorAll(t)):t instanceof Element?[t]:t instanceof NodeList?Array.from(t):t instanceof Array?t:[]}function V(t){const n=document.createElement("div");n.className=`scrollama__debug-step ${t}`,n.style.position="fixed",n.style.left="0",n.style.width="100%",n.style.zIndex="9999",n.style.borderTop="2px solid black",n.style.borderBottom="2px solid black";const o=document.createElement("p");return o.style.position="absolute",o.style.left="0",o.style.height="1px",o.style.width="100%",o.style.borderTop="1px dashed black",n.appendChild(o),document.body.appendChild(n),n}function W({id:t,step:n,marginTop:o}){const{index:f,height:a}=n,u=`scrollama__debug-step--${t}-${f}`;let d=document.querySelector(`.${u}`);d||(d=V(u)),d.style.top=`${o*-1}px`,d.style.height=`${a}px`,d.querySelector("p").style.top=`${a/2}px`}function X(){const t="abcdefghijklmnopqrstuvwxyz",n=Date.now(),o=[];for(let f=0;f<6;f+=1){const a=t[Math.floor(Math.random()*t.length)];o.push(a)}return`${o.join("")}${n}`}function O(t){console.error(`scrollama error: ${t}`)}function y(t){return+t.getAttribute("data-scrollama-index")}function Z(t,n){const o=Math.ceil(t/n),f=[],a=1/o;for(let u=0;u<o+1;u+=1)f.push(u*a);return f}function z(t){if(typeof t=="string"&&t.indexOf("px")>0){const n=+t.replace("px","");return isNaN(n)?(err("offset value must be in 'px' format. Fallback to 0.5."),{format:"percent",value:.5}):{format:"pixels",value:n}}else if(typeof t=="number"||!isNaN(+t))return t>1&&err("offset value is greater than 1. Fallback to 1."),t<0&&err("offset value is lower than 0. Fallback to 0."),{format:"percent",value:Math.min(Math.max(0,t),1)};return null}function ee(t){t.forEach(n=>n.node.setAttribute("data-scrollama-index",n.index))}function te(t){const{top:n}=t.getBoundingClientRect(),o=window.pageYOffset,f=document.body.clientTop||0;return n+o-f}let m,w,p;function _(t){const n=t?t.scrollTop:window.pageYOffset;m!==n&&(m=n,m>w?p="down":m<w&&(p="up"),w=m)}function ne(t){m=0,w=0,document.addEventListener("scroll",()=>_(t))}function oe(){let t={},n=X(),o=[],f,a,u,d=0,$=!1,T=!1,q=!1,A=!1,P=[];function I(){t={stepEnter:()=>{},stepExit:()=>{},stepProgress:()=>{}},P=[]}function E(e){e&&!$&&M(),!e&&$&&R(),$=e}function k(e,s){const r=y(e),i=o[r];s!==void 0&&(i.progress=s);const l={element:e,index:r,progress:s,direction:p};i.state==="enter"&&t.stepProgress(l)}function j(e,s=!0){const r=y(e),i=o[r],l={element:e,index:r,direction:p};i.direction=p,i.state="enter",P[r]||t.stepEnter(l),A&&(P[r]=!0)}function C(e,s=!0){const r=y(e),i=o[r];if(!i.state)return!1;const l={element:e,index:r,direction:p};T&&(p==="down"&&i.progress<1?k(e,1):p==="up"&&i.progress>0&&k(e,0)),i.direction=p,i.state="exit",t.stepExit(l)}function F([e]){const s=y(e.target),r=o[s],i=e.target.offsetHeight;i!==r.height&&(r.height=i,N(r),H(r),B(r))}function D([e]){_(a);const{isIntersecting:s,target:r}=e;s?j(r):C(r)}function L([e]){const s=y(e.target),r=o[s],{isIntersecting:i,intersectionRatio:l,target:g}=e;i&&r.state==="enter"&&k(g,l)}function N({observers:e}){Object.keys(e).map(s=>{e[s].disconnect()})}function R(){o.forEach(N)}function B(e){const s=new ResizeObserver(F);s.observe(e.node),e.observers.resize=s}function G(){o.forEach(B)}function H(e){const s=window.innerHeight,r=e.offset||f,i=r.format==="pixels"?1:s,l=r.value*i,g=e.height/2-l,x=e.height/2-(s-l),b={rootMargin:`${g}px 0px ${x}px 0px`,threshold:.5,root:u},Y=new IntersectionObserver(D,b);Y.observe(e.node),e.observers.step=Y,q&&W({id:n,step:e,marginTop:g})}function J(){o.forEach(H)}function K(e){const s=window.innerHeight,r=e.offset||f,i=r.format==="pixels"?1:s,l=r.value*i,g=-l+e.height,x=l-s,v=`${g}px 0px ${x}px 0px`,S=Z(e.height,d),h={rootMargin:v,threshold:S},b=new IntersectionObserver(L,h);b.observe(e.node),e.observers.progress=b}function Q(){o.forEach(K)}function M(){R(),G(),J(),T&&Q()}const c={};return c.setup=({step:e,parent:s,offset:r=.5,threshold:i=4,progress:l=!1,once:g=!1,debug:x=!1,container:v=void 0,root:S=null})=>(ne(v),o=U(e,s).map((h,b)=>({index:b,direction:void 0,height:h.offsetHeight,node:h,observers:{},offset:z(h.dataset.offset),top:te(h),progress:0,state:void 0})),o.length?(T=l,A=g,q=x,d=Math.max(1,+i),f=z(r),a=v,u=S,I(),ee(o),E(!0),c):(O("no step elements"),c)),c.enable=()=>(E(!0),c),c.disable=()=>(E(!1),c),c.destroy=()=>(E(!1),I(),c),c.resize=()=>(M(),c),c.offset=e=>e==null?f.value:(f=z(e),M(),c),c.onStepEnter=e=>(typeof e=="function"?t.stepEnter=e:O("onStepEnter requires a function"),c),c.onStepExit=e=>(typeof e=="function"?t.stepExit=e:O("onStepExit requires a function"),c),c.onStepProgress=e=>(typeof e=="function"?t.stepProgress=e:O("onStepProgress requires a function"),c),c}export{oe as s};
